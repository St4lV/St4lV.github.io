<html>
<head>
    <meta charset="UTF-8">
    <title>Tirnatek Radio</title>

    <link rel="icon" type="image/png" href="TNTRcolor.png">
    <meta property="image/png" content="TNTcolor.png">
    
    <link href="index.css" rel="stylesheet">
    <script src="index.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/cfe8b65519.js" crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=PT+Sans+Narrow&display=swap" rel="stylesheet">  

<style>
    table{
        border-collapse: collapse;

    }
    th, td {
        border: 1px solid rgb(255, 255, 255);
        padding: 4px;
        text-align: center;
    }
</style>
</head>

<body>
        <header>
       <a href="https://instagram.com/tirnatek" class="lieninsta" target="_blank">
     <div class="apb-insta">
         <i class="fa-brands fa-instagram"></i></div></a>

   <a href="https://instagram.com/tirnatek" class="lieninsta" target="_blank">
     <div class="apb-discord">
         <i class="fa-brands fa-discord"></i></div></a>

    <div class="disposition">
    <div class="one"><h1>Tirnatek Radio Bêta 2.2</h1>
    <p>Heure Actuelle : <span id="heureParis"></span></p>
</div>
<div class="lecteur-audio">
    <audio id="lecteurAudio" controls>
            <source src="https://tirnatek.fr/listen/tntr/tntr128.mp3" type="audio/mp3">
            Votre navigateur ne supporte pas l'élément audio.
        </audio>
</div>
<div class="audiobuttons">
    <button class="audioButton" data-source="https://tirnatek.fr/listen/tntr/tntr128.mp3">MP3 128kbps</button>
    <button class="audioButton" data-source="https://tirnatek.fr/listen/tntr/tntr320.mp3">MP3 320kbps</button>
    <button class="audioButton" data-source="https://tirnatek.fr/listen/tntr/tntr96.mp3">MP3 96kbps</button>
</div>
        </header>
<footer>
    <div class="metadata">
        <h4>En cours</h4>
        <div id="playlist">Playlist</div>
        <div id="musicInfoContainer"></div>
        <div id="elapsedCounter" style="display: none;"></div>
    <p> <br>TirnatekRadio@Beta2.2 <br> ~-~ </p>
</div>
</div>

    <script>
var currentSongId = null;
var formattedDuration = null;
var startTime = null;
var timer = null;

function updateMusicInfo(artist, title, elapsedValue, duration, songId) {
    formattedDuration = formatTime(duration);
    var musicInfo = `<div><p>${artist} - ${title}</p><p id="elapsedCounter">${formatTime(elapsedValue)} / ${formattedDuration}</p></div>`;
    $('#musicInfoContainer').html(musicInfo);

    if (currentSongId !== songId) {
        currentSongId = songId;
        clearInterval(timer);
        startTime = Date.now() - elapsedValue * 1000;
        timer = setInterval(updateElapsedTime, 1000);
    }

    setTimeout(function () {
        loadNowPlaying();
    }, duration * 20000);
}

function updateElapsedTime() {
    var currentTime = Date.now();
    var elapsed = Math.floor((currentTime - startTime) / 1000);
    $('#elapsedCounter').text(formatTime(elapsed) + ' / ' + formattedDuration);
}

function formatTime(seconds) {
    var date = new Date(null);
    date.setSeconds(seconds);
    return date.toISOString().substr(14, 5);
}

function loadNowPlaying() {
    $.getJSON('https://tirnatek.fr/api/nowplaying_static/tntr.json', function (np) {
        var artist = np.now_playing.song.artist;
        var title = np.now_playing.song.title;
        var elapsedValue = parseInt(np.now_playing.elapsed) || 0;
        var duration = np.now_playing.duration;
        var songId = np.now_playing.sh_id;

        updateMusicInfo(artist, title, elapsedValue, duration, songId);

        if (np.live.is_live === false) {
            if (np.now_playing.playlist !== "") {
                $('#playlist').html('<span class="badge badge-info">Playlist: ' + np.now_playing.playlist + '</span>');
            } else {
                $('#playlist').html('<span class="badge badge-important">LIVE</span>');
            }
        } else {
            $('#playlist').html('<span class="badge badge-important">Live: ' + np.live.streamer_name + '</span>');
        }

        setTimeout(loadNowPlaying, 15000);
    }).fail(function () {
        console.error('Failed to fetch data. Retrying in 30 seconds...');
        setTimeout(loadNowPlaying, 30000);
    });
}

$(document).ready(function () {
    loadNowPlaying();
});

</script>
</footer>
<script>
    function dynamicSchedule() {
        jQuery.ajax({
            cache: false,
            dataType: "json",
            url: 'https://tirnatek.fr/api/station/tntr/schedule?now=now&rows=48',
  
            success: function(gp) {
                var namesArray = [];
                var startTimesArray = [];
  
                $.each(gp, function(index, playlist) {
                    namesArray.push(playlist.name);
                  var startDate = new Date(playlist.start);
                  if (isNaN(startDate)) {
                      const parts = playlist.start.split(/[\sT\+]/);
                      const [year, month, day] = parts[0].split('-');
                      const [hour, minute, second] = parts[1].split(':');
                      startDate = new Date(year, month - 1, day, hour, minute, second);}
  
                  var formattedTime = startDate.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
                  startTimesArray.push(formattedTime);});
  
              var tbody = $('#scheduleBody');
              tbody.empty();
              for (var i = 0; i < namesArray.length; i++) {
                  var newRow = $('<tr>');
                  newRow.append($('<td>').text(namesArray[i]));
                  newRow.append($('<td>').text(startTimesArray[i]));
                  tbody.append(newRow);
              }},
            error: function(xhr, status, error) {
                console.error(status, error);
            }}); }
  
    jQuery(function() {
      dynamicSchedule();
  });
  </script>

  <div class="bgcentre">

   <div class="three">

    <h2><br><br><br><br>Planning de diffusion</h2>
    <p>(Effectif jusqu'au lendemain, minuit.)</p>

    <table id="scheduleTable">
    <thead>
        <tr>
            <th>Playlist</th>
            <th>Heure de diffusion</th>
        </tr>
    </thead>
    <tbody id="scheduleBody",class="policePlaylist">
    </tbody>
</table>
   </div>
<div class="datefin">
   <p><br>  <br>  <br>  <br>  <br>  <br>  <br>  >@2023tntr</p>    
</div>
   <div class="four">

          <p><br>Rejoins nous sur instagram - <a href="https://instagram.com/tirnatek" class="lieninsta">@tirnatek</a></p> 
          <p>N'hésitez pas à faire des suggestions de sons, sur l'interface, les playlists ect.. On prends ! :)</p>
          <p>TeamTNTR@Radio~# Projet à but éducatif svp la SACEM soyez cool <br>  <br> <br>  <br>  <br>  <br>  <br>  <br>  <br>  <br><br>  <br>  <br>Si tu vois ça tu es un ptit malin ou tu as un grand écran</p>
</div>          
</div>
</div>
</body>
</html>